<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./style.css">
</head>

<body>
  <h2>Task # 1. Спрячьте сообщения с помощью делегирования</h2>
  <div id="container">
    <div class="pane">
      <h3>Лошадь</h3>
      <p>Домашняя лошадь - животное семейства непарнокопытных, одомашненный и единственный сохранившийся подвид дикой
        лошади, вымершей в дикой природе, за исключением небольшой популяции лошади Пржевальского.</p>
      <button class="remove-button">[x]</button>
    </div>
    <div class="pane">
      <h3>Осёл</h3>
      <p>Домашний осёл или ишак — одомашненный подвид дикого осла, сыгравший важную историческую роль в развитии
        хозяйства и культуры человека. Все одомашненные ослы относятся к африканским ослам.</p>
      <button class="remove-button">[x]</button>
    </div>
    <div class="pane">
      <h3>Кошка</h3>
      <p>Кошка, или домашняя кошка (лат. Félis silvéstris cátus), — домашнее животное, одно из наиболее популярных
        (наряду с собакой) "животных-компаньонов". С точки зрения научной систематики, домашняя кошка — млекопитающее
        семейства кошачьих отряда хищных. Ранее домашнюю кошку нередко рассматривали как отдельный биологический вид.
      </p>
      <button class="remove-button">[x]</button>
    </div>
  </div>

  <script>
    document.addEventListener('click', (event) => {
      let item = event.target.closest('div.pane');
      if (event.target.className !== 'remove-button') return;

      item.remove();
    })
  </script>


  <code>
    document.addEventListener('click', (event) => {
      let item = event.target.closest('div.pane');
      if (event.target.className !== 'remove-button') return;

      item.remove();
    })
</code>

  <hr>


  <h2>Task # 2. Раскрывающееся дерево</h2>
  <ul class="tree" id="tree">
    <li>Животные
      <ul>
        <li>Млекопитающие
          <ul>
            <li>Коровы</li>
            <li>Ослы</li>
            <li>Собаки</li>
            <li>Тигры</li>
          </ul>
        </li>
        <li>Другие
          <ul>
            <li>Змеи</li>
            <li>Птицы</li>
            <li>Ящерицы</li>
          </ul>
        </li>
      </ul>
    </li>
    <li>Рыбы
      <ul>
        <li>Аквариумные
          <ul>
            <li>Гуппи</li>
            <li>Скалярии</li>
          </ul>
        </li>
        <li>Морские
          <ul>
            <li>Морская форель</li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <script>
    function wrap(li, className) {
      const wrapper = document.createElement('span');
      wrapper.classList = className;

      li.prepend(wrapper);
      wrapper.append(wrapper.nextSibling);
    }

    tree.querySelectorAll('li').forEach(li => {
      wrap(li, 'tree-li')
    });

    tree.addEventListener(`click`, (evt) => {
      if (evt.target.tagName !== `SPAN`) return;
      const childUl = evt.target.parentNode.querySelector(`ul`);

      if (childUl) childUl.hidden = !childUl.hidden;
    });
  </script>


  <code>
    function wrap(li, className) {
      const wrapper = document.createElement('span');
      wrapper.classList = className;

      li.prepend(wrapper);
      wrapper.append(wrapper.nextSibling);
    }

    tree.querySelectorAll('li').forEach(li => {
      wrap(li, 'tree-li')
    });

    tree.addEventListener(`click`, (evt) => {
      if (evt.target.tagName !== `SPAN`) return;
      const childUl = evt.target.parentNode.querySelector(`ul`);

      if (childUl) childUl.hidden = !childUl.hidden;
    });
</code>

  <hr>


  <h2>Task # 3. Сортируемая таблица</h2>
  <table id="grid">
    <thead>
      <tr>
        <th data-type="age">Возраст</th>
        <th data-type="name">Имя</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>5</td>
        <td>Вася</td>
      </tr>
      <tr>
        <td>2</td>
        <td>Петя</td>
      </tr>
      <tr>
        <td>12</td>
        <td>Женя</td>
      </tr>
      <tr>
        <td>9</td>
        <td>Маша</td>
      </tr>
      <tr>
        <td>1</td>
        <td>Илья</td>
      </tr>
    </tbody>
    <button id="reset">Reset sort</button>
  </table>


  <script>
    const resetSort = Array.from(grid.tBodies[0].rows);

    grid.querySelector('thead tr').onclick = event => {
      if (event.target.tagName != 'TH') return;

      const sortType = event.target.dataset.type;
      const table = event.currentTarget.closest('table');
      let tbody = table.tBodies[0];
      const cellIndex = event.target.cellIndex; // 0, 1 etc.
      const tbodyRows = Array.from(tbody.rows)

      const result = tbodyRows.sort((a, b) => {
        switch (sortType) {
          case 'age':
            return +a.cells[cellIndex].innerText - +b.cells[cellIndex].innerText;
            break;
          case 'name':
            return a.cells[cellIndex].innerText.localeCompare(b.cells[cellIndex].innerText, 'ru', { sensitivity: 'base' })
            break;
        }
      });

      tbody.append(...result);

      reset.addEventListener('click', () => {
        tbody.append(...resetSort)
      })
    }

  </script>


  <code>
    const resetSort = Array.from(grid.tBodies[0].rows);

    grid.querySelector('thead tr').onclick = event => {
      if (event.target.tagName != 'TH') return;

      const sortType = event.target.dataset.type;
      const table = event.currentTarget.closest('table');
      let tbody = table.tBodies[0];
      const cellIndex = event.target.cellIndex; // 0, 1 etc.
      const tbodyRows = Array.from(tbody.rows)

      const result = tbodyRows.sort((a, b) => {
        switch (sortType) {
          case 'age':
            return +a.cells[cellIndex].innerText - +b.cells[cellIndex].innerText;
            break;
          case 'name':
            return a.cells[cellIndex].innerText.localeCompare(b.cells[cellIndex].innerText, 'ru', { sensitivity: 'base' })
            break;
        }
      });

      tbody.append(...result);

      reset.addEventListener('click', () => {
        tbody.append(...resetSort)
      })
</code>

  <hr>


  <h2>Task # 4. Поведение "подсказка"</h2>

  <button data-tooltip="эта подсказка должна быть длиннее, чем элемент">Короткая кнопка</button>
  <button data-tooltip="HTML<br>подсказка">Ещё кнопка</button>

  <p>Прокрутите страницу, чтобы кнопки оказались у верхнего края, а затем проверьте правильно ли выводятся подсказки.
  </p>

  <script>
    let div;

    document.addEventListener('mouseover', (event) => {
      const tooltip = event.target.dataset.tooltip;
      const margin = 5;

      if (!tooltip) return;

      div = document.createElement('div');
      div.innerHTML = tooltip;
      div.classList.add('div-tooltip');
      document.body.append(div);

      const clientRect = event.target.getBoundingClientRect();
      const coords = {
        left: clientRect.left + (event.target.offsetWidth - div.offsetWidth) / 2,
        top: clientRect.top - div.offsetHeight - margin
      };

      if (clientRect.top - div.offsetHeight - margin < 0) {
        coords.top = clientRect.top + event.target.offsetHeight + margin;
      }

      if (clientRect.left - (event.target.offsetWidth - div.offsetWidth) / 2 < 0) {
        coords.left = 0;
      }

      div.style.top = coords.top + 'px';
      div.style.left = coords.left + 'px';
    });

    document.addEventListener('mouseout', event => {
      if (div) {
        div.remove();
        div = null;
      }
    });
  </script>


  <code>
    let div;

    document.addEventListener('mouseover', (event) => {
      const tooltip = event.target.dataset.tooltip;
      const margin = 5;

      if (!tooltip) return;

      div = document.createElement('div');
      div.innerHTML = tooltip;
      div.classList.add('div-tooltip');
      document.body.append(div);

      const clientRect = event.target.getBoundingClientRect();
      const coords = {
        left: clientRect.left + (event.target.offsetWidth - div.offsetWidth) / 2,
        top: clientRect.top - div.offsetHeight - margin
      };

      if (clientRect.top - div.offsetHeight - margin < 0) {
        coords.top = clientRect.top + event.target.offsetHeight + margin;
      }

      if (clientRect.left - (event.target.offsetWidth - div.offsetWidth) / 2 < 0) {
        coords.left = 0;
      }

      div.style.top = coords.top + 'px';
      div.style.left = coords.left + 'px';
    });

    document.addEventListener('mouseout', event => {
      if (div) {
        div.remove();
        div = null;
      }
    });
</code>

  <hr>

</body>

</html>