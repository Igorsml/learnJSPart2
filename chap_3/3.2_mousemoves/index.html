<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mouse events</title>
  <link rel="apple-touch-icon" sizes="180x180" href="../../favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../favicon/favicon-16x16.png.png">
  <link rel="manifest" href="../../favicon/site.webmanifest">
  <link rel="mask-icon" href="../../favicon/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <link rel="stylesheet" href="./style.css">
</head>

<body>

  <h2>Task # 1. Улучшенная подсказка</h2>
  <p>Напишите JavaScript код, который показывает подсказку над элементом с атрибутом data-tooltip. Значение атрибута
    должно становиться текстом подсказки.

    Это похоже на задачу Поведение "подсказка", но здесь элементы с подсказками могут быть вложены друг в друга.
    Показываться должна подсказка на самом глубоко вложенном элементе.

    Только одна подсказка может быть показана в любой момент времени.</p>

  <div data-tooltip="Здесь домашний интерьер" id="house">
    <div data-tooltip="Здесь крыша" id="roof"></div>

    <p>Жили-были на свете три поросенка. Три брата. Все одинакового роста, кругленькие, розовые, с одинаковыми веселыми
      хвостиками.</p>

    <p>Даже имена у них были похожи. Звали поросят: Ниф-Ниф, Нуф-Нуф и Наф-Наф. Все лето они кувыркались в зеленой
      траве, грелись на солнышке, нежились в лужах.</p>

    <p>Но вот наступила осень. Солнце уже не так сильно припекало, серые облака тянулись над пожелтевшим лесом.</p>

    <p>- Пора нам подумать о зиме, - сказал как-то Наф-Наф. <a
        href="https://ru.wikipedia.org/wiki/%D0%A2%D1%80%D0%B8_%D0%BF%D0%BE%D1%80%D0%BE%D1%81%D1%91%D0%BD%D0%BA%D0%B0"
        data-tooltip="Читать далее…">Наведи курсор на меня</a></p>

  </div>
  <script>
    let div;
    let currentElem = null;

    const house = document.querySelector('#house');

    house.onmouseover = (event) => {

      const tooltip = event.target.dataset.tooltip;
      const margin = 5;

      let target = event.target.closest('p');
      if (!tooltip) return;

      div = document.createElement('div');
      div.innerHTML = tooltip;
      div.classList.add('div-tooltip');
      document.body.append(div);

      const clientRect = event.target.getBoundingClientRect();
      const coords = {
        left: clientRect.left + (event.target.offsetWidth - div.offsetWidth) / 2,
        top: clientRect.top - div.offsetHeight - margin
      };

      if (clientRect.top - div.offsetHeight - margin < 0) {
        coords.top = clientRect.top + event.target.offsetHeight + margin;
      }

      if (clientRect.left - (event.target.offsetWidth - div.offsetWidth) / 2 < 0) {
        coords.left = 0;
      }

      div.style.top = coords.top + 'px';
      div.style.left = coords.left + 'px';
    };

    document.addEventListener('mouseout', event => {
      if (div) {
        div.remove();
        div = null;
      }
    });
  </script>
  <code>

  </code>

  <hr>
  <h2>Task # 2. "Умная" подсказка</h2>
  <p>Напишите функцию, которая показывает подсказку над элементом только в случае, когда пользователь передвигает мышь
    на него, но не через него.

    Другими словами, если пользователь подвинул курсор на элементе и остановился – показывать подсказку. А если он
    просто быстро провёл курсором по элементу, то не надо ничего показывать. Кому понравится лишнее мелькание?

    Технически, мы можем измерять скорость прохода курсора мыши над элементом, и если она низкая, то можно посчитать,
    что пользователь остановил курсор над элементом, и показать ему подсказку. А если скорость высокая, то тогда не
    показывать.

    Создайте для этого универсальный объект new HoverIntent(options).

    Его настройки options:

    elem – отслеживаемый элемент.
    over – функция, вызываемая, при заходе на элемент, считаем что заход – это когда курсор медленно двигается или
    остановился над элементом.
    out – функция, вызываемая при уходе курсора с элемента (если был заход).</p>
  <div id="elem" class="clock">
    <span class="hours">12</span> :
    <span class="minutes">30</span> :
    <span class="seconds">00</span>
  </div>

  <div id="tooltip" hidden>Подсказка</div>
  <script>
    // для демо
    setTimeout(function () {
      new HoverIntent({
        elem,
        over() {
          tooltip.hidden = false;
        },
        out() {
          tooltip.hidden = true;
        }
      });
    }, 2000);
  </script>

  <code>

  </code>

  <hr>

  <script src="./main.js"></script>
  <script src="hoverIntent.js"></script>
  <script src="https://js.cx/test/libs.js"></script>
  <script src="test.js"></script>
</body>

</html>